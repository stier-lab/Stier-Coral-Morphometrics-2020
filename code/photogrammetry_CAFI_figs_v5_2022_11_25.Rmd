---
output:
  html_document: default
  pdf_document: default
---

# Title: "Figures for Photogrammetry-CAFI manuscript"

author: "Joseph Curtis (modifying code by Journ Galvan)" date: "9/8/2020" output: html_document ---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, message=FALSE, include=FALSE}

rm(list=ls())

# Load libraries
library(here)
library(cowplot)
library(ggpubr)
library(ggpmisc)
library(kableExtra)
library(knitr)
library(qpcR)
library(investr)

source(here("code/source_data_cleanup_2022_11_25.R"))
```

# Supplementary Figure 2 - Linear regressions of Manual and Photogrammetric coral measurements

```{r supp_fig2_creator, message=FALSE, include = FALSE}
#SUPPLEMENTAL FIGURE 2


#Volume - Convex Hull vs ellipsoid
ellipsoid_pg <- ggplot(coral_dim, aes(x=ellipsoid_pg, y = volume_field))+ 
  geom_abline(intercept = 0, slope = 1, size = 1, lty = "dashed", color='dodgerblue4') + 
  geom_point(color = "black", size = 4, alpha = 0.7, fill = "coral", pch = 21) +
  geom_smooth(method=lm, color = "black", se = FALSE) +
  scale_y_continuous(breaks=seq(0,max(coral_dim$volume_field), by = 5000))+
  scale_x_continuous(breaks=seq(0,max(coral_dim$max_hull_volume, na.rm = TRUE)+1500, by = 5000))+
  theme_classic()+
  labs(y= expression(paste("Ellipsoid Volume - Manual (cm"^{3},")")), 
       x= expression(paste("Ellipsoid Volume - Photo (cm"^{3},")"))) +
  theme(text = element_text(size = 13, face = "bold"),
        axis.title = element_text(size = 13, face = "bold"),
        axis.text = element_text(size = 13, face = "bold"),
        axis.ticks = element_line(color = "black"))  #x intercept changed to be forced through 0

height <- ggplot(coral_dim, aes(x=height_pg, y=height_field))+ 
  geom_abline(intercept = 0, slope = 1, size = 1, lty = "dashed", color='dodgerblue4') + 
  geom_point(color = "black", size = 4, alpha = 0.7, fill = "coral", pch = 21) +
  geom_smooth(method=lm, color = "black", se = FALSE)+
  theme_classic()+
  xlim(c(0,max(coral_dim$height_pg + 2))) +
  ylim(c(0,max(coral_dim$height_field + 2))) +
  labs(y= "Manual Height (cm)", x= "Photogrammetry Height (cm)")+
   #x intercept changed to be forced through 0
  theme(text = element_text(size = 13, face = "bold"),
        axis.title = element_text(size = 13, face = "bold"),
        axis.text = element_text(size = 13, face = "bold"),
        axis.ticks = element_line(color = "black"))

#Length
length <- ggplot(coral_dim, aes(x=length_pg, y=length_field))+ 
  geom_abline(intercept = 0, slope = 1, size = 1, lty = "dashed", color='dodgerblue4') +
  geom_point(color = "black", size = 4, alpha = 0.7, fill = "coral", pch = 21) +
  geom_smooth(method=lm, color = "black", se = FALSE)+
  xlim(c(0,max(coral_dim$length_pg + 2))) +
  ylim(c(0,max(coral_dim$length_field + 2))) +
  theme_classic()+
  labs(y= "Manual Length (cm)", x= "Photogrammetry Length (cm)")+
   #x intercept changed to be forced through 0
  theme(text = element_text(size = 13, face = "bold"),
        axis.title = element_text(size = 13, face = "bold"),
        axis.text = element_text(size = 13, face = "bold"),
        axis.ticks = element_line(color = "black"))

#Width
width <- ggplot(coral_dim, aes(x=width_pg, y=width_field))+ 
 geom_point(color = "black", size = 4, alpha = 0.7, fill = "coral", pch = 21) +
  geom_smooth(method=lm, color = "black", se = FALSE) +
  theme_classic()+
  xlim(c(0,max(coral_dim$width_pg + 2))) +
  ylim(c(0,max(coral_dim$width_field + 2))) +
  labs(y= "Manual Width (cm)", x= "Photogrammetry Width (cm)") +
  geom_abline(intercept = 0, slope = 1, size = 1, lty = "dashed", color='dodgerblue4') + #x intercept changed to be forced through 0
  theme(text = element_text(size = 13, face = "bold"),
        axis.title = element_text(size = 13, face = "bold"),
        axis.text = element_text(size = 13, face = "bold"),
        axis.ticks = element_line(color = "black"))

 #x intercept changed to be forced through 0
figs2 <- cowplot::plot_grid(length, width, height, ellipsoid_pg, ncol = 2, nrow = 2, 
          align = "vh", labels = "AUTO")

ggsave(here("code","figures","cr_rev2_figs2.pdf"), figs2, device = "pdf", useDingbats = FALSE, width = 10, height = 7)

```

```{r figs2, fig.width = 9, fig.height = 6, message=FALSE, echo = FALSE}
figs2
```
# Figure 2 - Coral volume estimates vs. CAFI richness and diversity
```{r fig2 prep, include=FALSE, include=FALSE}

lm_abun_man <- lm(num_cafi~volume_field, data = cafi_coral)
nls_abun_man <- nls(num_cafi ~ a*volume_field^beta, cafi_coral, start = list(a = 1.35, beta = 0.32))

# Abun v Skeleton

lm_abun_skel <- lm(num_cafi~volume_pg, data = cafi_coral)
nls_abun_skel <- nls(num_cafi ~ a*volume_pg^beta, cafi_coral, start = list(a = 1, beta = 1))

# Rich v Ellipsoid

lm_rich_man <- lm(cafi_richness~volume_field, data = cafi_coral)
nls_rich_man <- nls(cafi_richness ~ a*volume_field^beta, cafi_coral, start = list(a = 1, beta = 1))

# Rich v Skeleton

lm_rich_skel <- lm(cafi_richness~volume_pg, data = cafi_coral)
nls_rich_skel <- nls(cafi_richness ~ a*volume_pg^beta, cafi_coral, start = list(a = 1, beta = 1))

# Rich v Hull

lm_rich_hull <- lm(cafi_richness~max_hull_volume, data = cafi_coral)
nls_rich_hull <- nls(cafi_richness ~ a*max_hull_volume^beta, cafi_coral, start = list(a = 1, beta = 1))


# Abun v Hull

lm_abun_hull <- lm(num_cafi~max_hull_volume, data = cafi_coral)
nls_abun_hull <- nls(num_cafi ~ a*max_hull_volume^beta, cafi_coral, start = list(a = 1, beta = 1))

# Abun v Photo Ellipsoid

lm_abun_pgell <- lm(num_cafi~ellipsoid_pg, data = cafi_coral)
nls_abun_pgell <- nls(num_cafi ~ a*ellipsoid_pg^beta, cafi_coral, start = list(a = 1, beta = 1))

# Abun v Photo Ellipsoid

lm_rich_pgell <- lm(cafi_richness~ellipsoid_pg, data = cafi_coral)
nls_rich_pgell <- nls(cafi_richness ~ a*ellipsoid_pg^beta, cafi_coral, start = list(a = 1, beta = 1))


formula1 <- y~a*x^beta

# Plot confidence intervals around regression
plot_man_abun <- as.data.frame(predFit(nls_abun_man, interval = "confidence", level = 0.95)) %>% cbind(cafi_coral)
plot_pgell_abun <- as.data.frame(predFit(nls_abun_pgell, interval = "confidence", level = 0.95)) %>% cbind(cafi_coral)
plot_skel_abun <- as.data.frame(predFit(nls_abun_skel, interval = "confidence", level = 0.95)) %>% cbind(cafi_coral)
plot_hull_abun <- as.data.frame(predFit(nls_abun_hull, interval = "confidence", level = 0.95)) %>% cbind(cafi_coral)
plot_man_rich <- as.data.frame(predFit(nls_rich_man, interval = "confidence", level = 0.95)) %>% cbind(cafi_coral)
plot_pgell_rich <- as.data.frame(predFit(nls_rich_pgell, interval = "confidence", level = 0.95)) %>% cbind(cafi_coral)
plot_skel_rich <- as.data.frame(predFit(nls_rich_skel, interval = "confidence", level = 0.95)) %>% cbind(cafi_coral)
plot_hull_rich <- as.data.frame(predFit(nls_rich_hull, interval = "confidence", level = 0.95)) %>% cbind(cafi_coral)


#Plot invert abundance to  volume
invert_field <- ggplot(plot_man_abun, aes(x=volume_field, y=num_cafi)) + 
  geom_smooth(method = "nls", formula = formula1, method.args = list(start = list(a = 1, beta = 1)), se = FALSE, color = "#edae52", fill = "#edae52") +
  geom_point(color = "black", pch = 21, fill = "#edae52", size = 3.5, alpha = 0.7) +
  geom_ribbon(aes(ymin = lwr, ymax = upr), fill= "#edae52", alpha = 0.2) +
  theme_classic()+
  ylim(c(0,76)) +
  labs(y="CAFI Abundance", x= expression(paste("Ellipsoid Volume (cm"^{3},")"))) +
  theme(axis.text = element_text(size = 12.5), axis.title = element_text(size = 15),
        axis.title.x = element_blank()) +
  coord_cartesian()


#Plot invert abundance to skeleton volume
invert_pg <- ggplot(plot_skel_abun, aes(x=volume_pg, y=num_cafi))+ 
  geom_smooth(method=nls, formula = formula1, se = FALSE, method.args = list(start = list(a = 1, beta = 1)), color = "#5fb2b2", fill = "#5fb2b2")+
  geom_point(color = "black", pch = 21, fill = "#5fb2b2", size = 3.5, alpha = 0.7)+
  theme_classic()+
  geom_ribbon(aes(ymin = lwr, ymax = upr), fill= "#5fb2b2", alpha = 0.2) +
  ylim(c(0,76)) +
  labs(y="CAFI Abundance", x= expression(paste("Skeletal Volume (cm"^{3},")"))) +
  theme(axis.text = element_text(size = 12.5), axis.title = element_blank()) +
  coord_cartesian()

#Plot invert abundance to software estimated ellipsoid volume
invert_pgell <- ggplot(plot_pgell_abun, aes(x=ellipsoid_pg, y=num_cafi))+ 
  geom_smooth(method=nls, formula = formula1, se = FALSE, method.args = list(start = list(a = 1, beta = 1)), color = "coral", fill = "coral")+
  geom_point(color = "black", pch = 21, fill = "coral", size = 3.5, alpha = 0.7)+
  theme_classic()+
  geom_ribbon(aes(ymin = lwr, ymax = upr), fill= "coral", alpha = 0.2) +
  ylim(c(0,76)) +
  labs(y="CAFI Abundance", x= expression(paste("Ellipsoid Volume (cm"^{3},")"))) +
  theme(axis.text = element_text(size = 12.5), axis.title = element_blank()) +
  coord_cartesian()


#Plot invert abundance to hull volume
invert_hull <- ggplot(plot_hull_abun, aes(x=max_hull_volume, y=num_cafi))+ 
  geom_smooth(method=nls, formula = formula1, method.args = list(start = list(a = 1, beta = 1)), se = FALSE, color = "dodgerblue1", fill = "dodgerblue1")+
  geom_point(color = "black", pch = 21, fill = "dodgerblue1", size = 3.5, alpha = 0.7)+
  geom_ribbon(aes(ymin = lwr, ymax = upr), fill= "dodgerblue1", alpha = 0.2) +
  theme_classic()+
  ylim(c(0,76)) +
  labs(y="CAFI Abundance", x= expression(paste("Convex Hull Volume (cm"^{3},")"))) +
  theme(axis.text = element_text(size = 12.5), axis.title = element_blank())


#Plot invert richness to manual volume
richness_field <- ggplot(plot_man_rich, aes(x=volume_field, y=cafi_richness))+ 
  geom_smooth(method=nls, formula = formula1, method.args = list(start = list(a = 1, beta = 1)), se = FALSE, color = "#edae52", fill = "#edae52")+
  geom_point(color = "black", pch = 21, fill = "#edae52", size = 3.5, alpha = 0.7)+
  geom_ribbon(aes(ymin = lwr, ymax = upr), fill= "#edae52", alpha = 0.2) +
  theme_classic()+
  labs(y="CAFI Richness", x= expression(paste("Ellipsoid Volume (cm"^{3},")"))) +
  scale_y_continuous(limits = c(0,27), breaks = seq(0,25,5)) +
  theme(axis.text = element_text(size = 12.5), axis.title = element_text(size = 15))

#Plot invert richness to software estimated volume
richness_pg <- ggplot(plot_skel_rich, aes(x=volume_pg, y=cafi_richness))+ 
  geom_smooth(method=nls, formula = formula1, method.args = list(start = list(a = 1, beta = 1)), se = FALSE, color = "#5fb2b2", fill = "#5fb2b2")+
  geom_point(color = "black", pch = 21, fill = "#5fb2b2", size = 3.5, alpha = 0.7)+
  geom_ribbon(aes(ymin = lwr, ymax = upr), fill= "#5fb2b2", alpha = 0.2) +
  theme_classic()+
  scale_y_continuous(limits = c(0,27), breaks = seq(0,25,5)) +
  labs(y="CAFI Richness", x= expression(paste("Skeletal Volume (cm"^{3},")"))) +
  theme(axis.text = element_text(size = 12.5), axis.title = element_text(size = 15),
        axis.title.y = element_blank()) 

#Plot invert richness to software estimated ellipsoid volume
richness_pgell <- ggplot(plot_pgell_rich, aes(x=ellipsoid_pg, y=cafi_richness))+ 
  geom_smooth(method=nls, formula = formula1, method.args = list(start = list(a = 1, beta = 1)), se = FALSE, color = "coral", fill = "coral")+
  geom_point(color = "black", pch = 21, fill = "coral", size = 3.5, alpha = 0.7)+
  geom_ribbon(aes(ymin = lwr, ymax = upr), fill= "coral", alpha = 0.2) +
  theme_classic()+
  scale_y_continuous(limits = c(0,27), breaks = seq(0,25,5)) +
  labs(y="CAFI Richness", x= expression(paste("Ellipsoid Volume (cm"^{3},")"))) +
  theme(axis.text = element_text(size = 12.5), axis.title = element_text(size = 15),
        axis.title.y = element_blank()) 


#Plot invert richness to software estimated volume
richness_hull <- ggplot(plot_hull_rich, aes(x=max_hull_volume, y=cafi_richness))+ 
  geom_smooth(method=nls, formula = formula1, method.args = list(start = list(a = 1, beta = 1)), se = FALSE, color = "dodgerblue1", fill = "dodgerblue1")+
  geom_point(color = "black", pch = 21, fill = "dodgerblue1", size = 3.5, alpha = 0.7)+
  geom_ribbon(aes(ymin = lwr, ymax = upr), fill= "dodgerblue1", alpha = 0.2) +
  theme_classic()+
  scale_y_continuous(limits = c(0,27), breaks = seq(0,25,5)) +
  labs(y="CAFI Richness", x= expression(paste("Convex Hull Volume (cm"^{3},")"))) +
  theme(axis.text = element_text(size = 12.5), axis.title = element_text(size = 15),
        axis.title.y = element_blank())

# Bind plots
fig2_raw <- plot_grid(invert_field, invert_pgell, invert_hull, invert_pg, 
                      richness_field, richness_pgell, richness_hull, richness_pg, nrow = 2, ncol = 4, align = "vh", labels = "AUTO")

ggsave(here("code","figures","cr_rev2_fig2.pdf"), fig2_raw, device = "pdf", useDingbats = FALSE, width = 12.5, height = 5)
```

```{r fig2, fig.width = 9, fig.height = 6, message=FALSE, echo = FALSE}
fig2_raw
```
# Figure 1 - Proportional Growth estimates from different volume metrics
```{r fig1, include = TRUE, echo = FALSE}

# Growth Mean Plots

prop_mean_plot <- 
  ggplot(december_summary_stats, aes(x = method, y = mean_prop_growth)) +
    geom_hline(aes(yintercept = 0), linetype = "dashed", size = 1.2) +
  geom_jitter(data = december_stacked, aes(x = method, y = prop_growth, fill = method),
                width = 0.05, size = 2, alpha = 0.5, pch = 21, color = "grey50") +
    geom_errorbar(aes(ymin = mean_prop_growth - se_prop,
                      ymax = mean_prop_growth + se_prop), width = 0.2,
                  size = 0.8, color = "black") +
    geom_point(size = 3.5, pch = 21, color = "black", aes(fill = december_summary_stats$method)) +
    scale_fill_manual(labels = c("Ellipsoid", "Ellipsoid PG", "Convex Hull", "Skeleton"), values = c("#edae52", "coral", "dodgerblue1", "#5fb2b2")) +
    labs(x = "", y = expression(paste("% Change in Volume"))) +
    scale_y_continuous(breaks = c(-20, 0, 20, 40, 60, 80, 100, 120)) +
    theme_classic() +
    theme(legend.position = "none", text = element_text(size = 15, face = "bold", color = "black"),
          axis.ticks = element_line(color = "black"))

 ggsave(here("code","figures","cr_rev2_fig1.pdf"), prop_mean_plot, device = "pdf", useDingbats = FALSE, height = 6, width = 5)
```

# Supplementary Figure 3 - Growth vs. coral volume allometry
```{r figs3, include = FALSE, echo = FALSE}

formula1 <- y~x

prop_growth_v_vol <- ggplot(december_stacked, aes(volume_aug, prop_growth, color = method)) +
  geom_point(size = 3.5, alpha = 0.6, pch = 21, color = "black", aes(fill = method)) +
  geom_smooth(method = "lm", aes(fill = method), alpha = 0.2) +
  stat_poly_eq(aes(label = paste(..rr.label.., sep = "~~~")), 
               label.x.npc = "right", label.y.npc = "top",
               formula = formula1, parse = TRUE, size = 5, color = "black") +
  theme_classic() +
  scale_fill_manual(labels = NULL, values = c("#edae52", "coral", "dodgerblue1", "#5fb2b2"), guide = FALSE) +
  scale_color_manual(labels = c("Ellipsoid","Photo Ellipsoid", "Convex Hull", "Skeleton"), 
                     values = c("#edae52", "coral", "dodgerblue1", "#5fb2b2"), guide = FALSE) +
  labs(x = expression(paste("Initial Volume (cm"^{3},")")),
       y = expression(paste("% Change in Volume")))  +
  theme(text = element_text(size = 13, face = "bold", color = "black"),
        axis.ticks = element_line(color = "black")) +
  facet_wrap(~method, scales  = "free_x")

ggsave(here("code","figures","cr_rev2_figs3.pdf"), prop_growth_v_vol, device = "pdf", useDingbats = FALSE, height = 6, width = 6)

```
# Supp. Table 1 - Photogrammetric and manual correlations of size and growth
```{r tab_s1_prep, message=FALSE, include=FALSE}

options(scipen = 999)
cor_sum <- function(input2, input3, cor_x) {
  temp <- data.frame(matrix(ncol = 6))
  temp_cols <- c("Var1", "Var2", "df", "t", "r", "p")
  colnames(temp) <- temp_cols
  temp$Var1 <- paste(input2)
  temp$Var2 <- paste(input3)
  temp$df <- as.numeric(cor_x$parameter)
  temp$t <- signif(as.numeric(cor_x$statistic),3)
  temp$r <- signif(as.numeric(cor_x$estimate),3)
  temp$p <- signif(as.numeric(cor_x$p.value),3)
  temp
}

# Correlations

## Linear Dimensions

cor_length <- cor.test(coral_dim$length_field, coral_dim$length_pg)
cor_width <- cor.test(coral_dim$width_field, coral_dim$width_pg)
cor_height <- cor.test(coral_dim$height_field, coral_dim$height_pg)

## Volume - Manual vs. Photo

#  Manual Ellipsoid vs. Photo Ellipsoid

cor_ellipse <- cor.test(coral_dim$volume_field, coral_dim$ellipsoid_pg)

# Convex Hull vs Manual Ellipse

cor_conv_vs_ellipse <- cor.test(coral_dim$volume_field, coral_dim$max_hull_volume)

# Ellipse vs Skeleton

cor_vol_vs_ellipse <- cor.test(coral_dim$volume_field, coral_dim$volume_pg)

## Volume - Photo vs Photo

# Photo Ellipsoid vs. Hull Volume

cor_pg_ell_hull <- cor.test(coral_dim$ellipsoid_pg, coral_dim$max_hull_volume)

# Photo Ellipsoid vs. Skeleton

cor_pg_ell_skel <- cor.test(coral_dim$ellipsoid_pg, coral_dim$volume_pg)

# Convex Hull vs. Skeleton
cor_pg_hull_skel <- cor.test(coral_dim$max_hull_volume, coral_dim$volume_pg)

### Growth Prop

# Growth Prop Manual Ellipsoid vs PG Ellipsoid

cor_prop_growth_man_vs_pgell <- cor.test(aug_and_dec$prop_growth_man,
                                        aug_and_dec$prop_ellipsoid_growth_pg)

# Growth Prop Manual Ellipsoid vs Hull

cor_prop_growth_man_vs_hull <- cor.test(aug_and_dec$prop_growth_man, aug_and_dec$prop_hull_growth, 
                                        na.rm = TRUE)

# Growth Prop Manual Ellipsoid vs Skeleton

cor_prop_growth_man_vs_pg <- cor.test(aug_and_dec$prop_growth_man, aug_and_dec$prop_growth_pg)

# Growth Prop Photo Ellipsoid vs. Hull
cor_prop_growth_pgell_vs_hull <- cor.test(aug_and_dec$prop_ellipsoid_growth_pg,
                                      aug_and_dec$prop_hull_growth,
                                      na.rm = TRUE)

# Growth Prop Photo Ellipsoid vs. Skeleton
cor_prop_growth_pgell_vs_skel <- cor.test(aug_and_dec$prop_ellipsoid_growth_pg,
                                      aug_and_dec$prop_growth_pg)

# Growth Prop Hull vs. Skeleton

cor_prop_growth_hull_vs_skel <- cor.test(aug_and_dec$prop_hull_growth,
                                      aug_and_dec$prop_growth_pg,
                                      na.rm = TRUE)


tabs1_raw <- rbind(cor_sum("Length (Man)","Length (Photo)", cor_length),
                   cor_sum("Width (Man)", "Width (Photo)", cor_width),
                   cor_sum("Height (Man)", "Height (Photo)", cor_height),
                   cor_sum("Ellipsoid (Man)", "Ellipsoid (Photo)", cor_ellipse),
                   cor_sum("Ellipsoid (Man)", "Hull (Photo)", cor_conv_vs_ellipse),
                   cor_sum("Ellipsoid (Man)", "Skeleton (Photo)", cor_vol_vs_ellipse),
                   cor_sum("Ellipsoid (Photo)", "Hull (Photo)", cor_pg_ell_hull),
                   cor_sum("Ellipsoid (Photo)", "Skeleton (Photo)", cor_pg_ell_skel),
                   cor_sum("Hull (Photo)", "Skeleton (Photo)", cor_pg_hull_skel),
                   cor_sum("Ellipsoid (Man)", "Ellipsoid (Photo)", cor_prop_growth_man_vs_pgell),
                   cor_sum("Ellipsoid (Man)", "Hull (Photo)", cor_prop_growth_man_vs_hull),
                   cor_sum("Ellipsoid (Man)", "Skeleton (Photo)", cor_prop_growth_man_vs_pg),
                   cor_sum("Ellipsoid (Photo)", "Hull (Photo)", cor_prop_growth_pgell_vs_hull),
                   cor_sum("Ellipsoid (Photo)", "Skeleton (Photo)", cor_prop_growth_pgell_vs_skel),
                   cor_sum("Hull (Photo)", "Skeleton (Photo)", cor_prop_growth_hull_vs_skel)
                   )

tabs1_raw <- tabs1_raw %>% 
  mutate_if(is.numeric, as.character) %>% 
  mutate(p = if_else(as.numeric(tabs1_raw$p)>0.001, as.character(tabs1_raw$p), "<0.001"))


tbl_s1 <- kbl(tabs1_raw, booktabs = TRUE) %>% 
  kable_classic() %>% 
  kable_styling(bootstrap_options = c("striped", "bordered")) %>% 
  pack_rows("Size", 1,9) %>% 
  pack_rows("Growth", 10,15) %>% 
  column_spec(6, bold = ifelse(tabs1_raw$p < 0.05, "TRUE", "FALSE"))

tbl_s1

save_kable(tbl_s1, here("code/figures/table_s1.html"))

```

# Supp. Table 2 - Statistics of CAFI abundance and richness against coral volume estimates
```{r tab_2_prep, message=FALSE, include=FALSE}

options(scipen = 999)
reg_sum <- function(input2, input3, nls_x) {
  temp <- data.frame(matrix(ncol = 10))
  temp_cols <- c("Variable", "Method", "a", "SE_a", "b", "SE_b", "t_b", "p_b", "AIC","RMSE")
  colnames(temp) <- temp_cols
  temp$Variable <- paste(input2)
  temp$Method <- paste(input3)
  temp$a <- signif(as.numeric(coefficients(nls_x)[1]),3)
  temp$"SE_a" <- signif(summary(nls_x)$coefficients[1,2],3)
  temp$b <- signif(as.numeric(coefficients(nls_x)[2]),3)
  temp$"SE_b" <- signif(summary(nls_x)$coefficients[2,2],3)
  temp$"t_b" <- signif(summary(nls_x)$coefficients[2,3],3)
  temp$"p_b" <- signif(summary(nls_x)$coefficients[2,4],3)
  temp$AIC <- signif(AIC(nls_x),5)
  temp$RMSE <- signif(qpcR::RMSE(nls_x),5)
  temp
}

abun_tab <- rbind(reg_sum("Ellipsoid", "Manual", nls_abun_man),
                  reg_sum("Ellipsoid", "Photo", nls_abun_pgell),
                  reg_sum("Convex Hull", "Photo", nls_abun_hull),
                  reg_sum("Skeletal Volume", "Photo", nls_abun_skel))
                  

```

```{r tab_1prep_rich, message=FALSE, include=FALSE}

richness_tab <- rbind(reg_sum("Ellipsoid", "Manual", nls_rich_man), 
                      reg_sum("Ellipsoid", "Photo", nls_rich_pgell),
                      reg_sum("Convex Hull", "Photo", nls_rich_hull), 
                      reg_sum("Skeletal Volume", "Photo", nls_rich_skel))

```

```{r pub_table_prep, include = FALSE}

tbl_raw <- rbind(abun_tab,richness_tab)

tbl_raw <- tbl_raw %>% 
  mutate_if(is.numeric, as.character) %>% 
  mutate(p_b = if_else(as.numeric(tbl_raw$p_b)>0.001, as.character(tbl_raw$p_b), "<0.001"))


tbl_s2 <- kbl(tbl_raw, booktabs = TRUE, digits = c(1,1,1,1,1,1,3)) %>% 
  kable_classic() %>% 
  kable_styling(bootstrap_options = c("striped", "bordered")) %>% 
  pack_rows("Abundance", 1,4) %>% 
  pack_rows("Richness", 5,8) %>% 
  column_spec(8, bold = ifelse(tbl_raw$p_b < 0.05, "TRUE", "FALSE"))

save_kable(tbl_s2, here("code/figures/table_s2.html"))
```

```{r pub_table, include = TRUE}
tbl_s2
```
# Miscellaneous Statistics

```{r stats}
num_photos <- summary(c(coral_dim$total_photos, december_photo$total_photos))
num_photos

```

